<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¯å¢ƒæ£€æµ‹æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .info { background: #f0f8ff; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe6e6; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #e6ffe6; padding: 15px; margin: 10px 0; border-radius: 5px; }
        button { padding: 10px 20px; margin: 10px 5px; background: #007acc; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #005999; }
    </style>
</head>
<body>
    <h1>ğŸ” Life Coach AI ç¯å¢ƒæ£€æµ‹</h1>
    
    <div id="envInfo" class="info">
        <h3>ğŸŒ ç¯å¢ƒä¿¡æ¯</h3>
        <div id="envDetails">æ­£åœ¨æ£€æµ‹...</div>
    </div>
    
    <div id="apiTest" class="info">
        <h3>ğŸ“¡ API æµ‹è¯•</h3>
        <button onclick="testAPI()">æµ‹è¯• API è¿æ¥</button>
        <div id="apiResult">ç­‰å¾…æµ‹è¯•...</div>
    </div>
    
    <div id="fixInfo" class="error">
        <h3>ğŸ”§ å¦‚æœçœ‹åˆ° localhost é”™è¯¯</h3>
        <p>1. ç¡®ä¿å·²é‡æ–°éƒ¨ç½²é¡¹ç›®</p>
        <p>2. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ï¼šCtrl+Shift+R</p>
        <p>3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</p>
        <p>4. ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•</p>
    </div>

    <script>
        // ç¯å¢ƒæ£€æµ‹
        const hostname = window.location.hostname;
        const currentOrigin = window.location.origin;
        const isLocalhost = hostname === 'localhost' || hostname === '127.0.0.1';
        
        let API_URL;
        if (isLocalhost) {
            API_URL = 'http://localhost:3001/api/chat';
        } else {
            API_URL = '/api/chat';
        }
        
        // æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯
        document.getElementById('envDetails').innerHTML = `
            <p><strong>ä¸»æœºå:</strong> ${hostname}</p>
            <p><strong>åŸŸå:</strong> ${currentOrigin}</p>
            <p><strong>æ˜¯å¦æœ¬åœ°:</strong> ${isLocalhost}</p>
            <p><strong>API URL:</strong> <span style="color: ${API_URL.includes('localhost') ? 'red' : 'green'}">${API_URL}</span></p>
            <p><strong>ç”¨æˆ·ä»£ç†:</strong> ${navigator.userAgent}</p>
        `;
        
        // API æµ‹è¯•å‡½æ•°
        async function testAPI() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æµ‹è¯•...';
            
            try {
                console.log('ğŸ” æµ‹è¯• API:', API_URL);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: 'ping'
                    })
                });
                
                console.log('ğŸ“¥ å“åº”çŠ¶æ€:', response.status);
                console.log('ğŸ“¥ å“åº”å¤´:', Object.fromEntries(response.headers.entries()));
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('âœ… API å“åº”:', data);
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <p>âœ… API è¿æ¥æˆåŠŸï¼</p>
                        <p><strong>çŠ¶æ€:</strong> ${response.status}</p>
                        <p><strong>å“åº”:</strong> ${JSON.stringify(data, null, 2)}</p>
                    </div>
                `;
                
            } catch (error) {
                console.error('âŒ API é”™è¯¯:', error);
                
                resultDiv.innerHTML = `
                    <div class="error">
                        <p>âŒ API è¿æ¥å¤±è´¥</p>
                        <p><strong>é”™è¯¯:</strong> ${error.message}</p>
                        <p><strong>API URL:</strong> ${API_URL}</p>
                        <details>
                            <summary>è¯¦ç»†é”™è¯¯ä¿¡æ¯</summary>
                            <pre>${error.stack || error.toString()}</pre>
                        </details>
                    </div>
                `;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(testAPI, 1000);
        });
        
        // æ˜¾ç¤ºç¯å¢ƒçŠ¶æ€
        if (hostname.includes('vercel.app')) {
            if (API_URL.includes('localhost')) {
                document.getElementById('fixInfo').style.display = 'block';
                console.error('ğŸš¨ æ£€æµ‹åˆ°é…ç½®é”™è¯¯ï¼šVercel ç¯å¢ƒä¸åº”è¯¥ä½¿ç”¨ localhost API');
            } else {
                document.getElementById('fixInfo').innerHTML = '<div class="success"><h3>âœ… ç¯å¢ƒé…ç½®æ­£ç¡®</h3><p>Vercel ç¯å¢ƒæ­£åœ¨ä½¿ç”¨æ­£ç¡®çš„ API ç«¯ç‚¹</p></div>';
            }
        }
    </script>
</body>
</html>